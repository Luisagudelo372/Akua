{% extends 'core/base.html' %}
{% load static %}

{% block title %}Dashboard ‚Äî Akua{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="mb-4">
    <h1 class="display-5 fw-bold mb-2" style="
      background: linear-gradient(135deg, #F04D43 0%, #F06B43 50%, #F08A43 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    ">
      <i class="bi bi-speedometer2 me-2"></i>Dashboard
    </h1>
    <p class="text-muted">Resumen de tus viajes y experiencias</p>
  </div>

  <div class="row g-4">
    <!-- Your Routes -->
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100" style="border-top: 4px solid #F06B43 !important;">
        <div class="card-body">
          <h5 class="fw-semibold mb-4 d-flex align-items-center">
            <span class="me-2 d-flex align-items-center justify-content-center rounded-circle" style="
              width: 36px;
              height: 36px;
              background: linear-gradient(135deg, #F04D43, #F06B43);
              color: white;
            ">
              <i class="bi bi-map-fill"></i>
            </span>
            Your Routes
          </h5>

          {% if routes %}
            <div class="list-group list-group-flush">
              {% for route in routes %}
                <div class="list-group-item px-0 border-0 border-bottom">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1 fw-semibold" style="color: #2c3e50;">
                        <i class="bi bi-geo-alt-fill me-1" style="color: #F06B43;"></i>
                        {{ route.city }}, {{ route.country }}
                      </h6>
                      <small class="text-muted">
                        <i class="bi bi-calendar3 me-1"></i>{{ route.days }} d√≠as
                        <span class="mx-1">‚Ä¢</span>
                        <i class="bi bi-wallet2 me-1"></i>{{ route.budget }}
                      </small>
                    </div>
                    <small class="text-muted">{{ route.created_at|date:"d/m/Y" }}</small>
                  </div>
                  
                  <!-- üëá SOLO 2 BOTONES -->
                  <div class="d-flex gap-2 mt-2">
                    <button class="btn btn-sm btn-outline-secondary" 
                            onclick="showRouteDetails('{{ route.ai_response|escapejs }}')"
                            style="border-color: #F06B43; color: #F06B43;">
                      <i class="bi bi-eye me-1"></i>Ver detalles
                    </button>
                    
                    <a href="{{ route.get_complete_route_url }}" 
                       target="_blank"
                       class="btn btn-sm"
                       style="background: linear-gradient(135deg, #10b981, #059669); border: none; color: white;"
                       title="Ver ruta completa con lugares del itinerario">
                      <i class="bi bi-map-fill me-1"></i>Ver ruta completa
                    </a>
                  </div>
                </div>
              {% endfor %}
            </div>
            
            <a href="{% url 'donde_ir' %}" class="btn btn-akua w-100 mt-3 rounded-pill">
              <i class="bi bi-plus-circle me-2"></i>Generar nueva ruta
            </a>
          {% else %}
            <div class="text-center py-5">
              <i class="bi bi-map" style="font-size: 3rem; color: #dee2e6;"></i>
              <p class="text-muted mt-3 mb-4">No has generado ninguna ruta a√∫n</p>
              <a href="{% url 'donde_ir' %}" class="btn btn-akua rounded-pill">
                <i class="bi bi-magic me-2"></i>Generar mi primera ruta
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Places Visited -->
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100" style="border-top: 4px solid #F08A43 !important;">
        <div class="card-body">
          <h5 class="fw-semibold mb-4 d-flex align-items-center">
            <span class="me-2 d-flex align-items-center justify-content-center rounded-circle" style="
              width: 36px;
              height: 36px;
              background: linear-gradient(135deg, #F08A43, #F0A843);
              color: white;
            ">
              <i class="bi bi-pin-map-fill"></i>
            </span>
            Places Visited
          </h5>

          {% if visited_places %}
            <div class="d-flex flex-wrap gap-2 mb-3">
              {% for place in visited_places %}
                <span class="badge rounded-pill px-3 py-2" style="
                  background: linear-gradient(135deg, rgba(240, 107, 67, 0.1), rgba(240, 138, 67, 0.1));
                  color: #F04D43;
                  border: 1px solid rgba(240, 107, 67, 0.3);
                  font-weight: 500;
                ">
                  <i class="bi bi-geo-fill me-1"></i>{{ place }}
                </span>
              {% endfor %}
            </div>
            
            <div class="d-flex gap-2 mt-3">
              <a href="{% url 'profile' %}" class="btn btn-sm btn-outline-secondary rounded-pill">
                <i class="bi bi-pencil me-1"></i>Editar en perfil
              </a>
              <a href="{% url 'write_review' %}" class="btn btn-sm btn-akua rounded-pill">
                <i class="bi bi-star me-1"></i>Escribir rese√±a
              </a>
            </div>
          {% else %}
            <div class="text-center py-5">
              <i class="bi bi-pin-map" style="font-size: 3rem; color: #dee2e6;"></i>
              <p class="text-muted mt-3 mb-4">No has visitado ning√∫n lugar a√∫n</p>
              <div class="d-flex gap-2 justify-content-center">
                <a href="{% url 'profile' %}" class="btn btn-outline-secondary rounded-pill">
                  <i class="bi bi-person me-1"></i>Actualizar perfil
                </a>
                <a href="{% url 'write_review' %}" class="btn btn-akua rounded-pill">
                  <i class="bi bi-star me-1"></i>Escribir rese√±a
                </a>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para ver detalles de la ruta -->
<div class="modal fade" id="routeModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header" style="border-bottom: 2px solid #F06B43;">
        <h5 class="modal-title fw-bold" style="color: #F04D43;">
          <i class="bi bi-map-fill me-2"></i>Detalles de la Ruta
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="routeDetails" style="white-space: pre-line; line-height: 1.8;">
        <!-- Los detalles se cargar√°n aqu√≠ -->
      </div>
    </div>
  </div>
</div>

<script>
function showRouteDetails(aiResponse) {
  document.getElementById('routeDetails').innerHTML = aiResponse.replace(/\n/g, '<br>');
  const modal = new bootstrap.Modal(document.getElementById('routeModal'));
  modal.show();
}
</script>

<style>
  .btn-akua:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(240, 107, 67, 0.3);
  }
  
  .list-group-item {
    transition: background-color 0.2s;
  }
  
  .list-group-item:hover {
    background-color: rgba(240, 107, 67, 0.03);
  }
  
  /* Hover para bot√≥n de ruta completa */
  .btn-sm[href]:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    transition: all 0.2s ease;
  }
  
  .btn-outline-secondary:hover {
    background-color: rgba(240, 107, 67, 0.1);
    border-color: #F04D43;
    color: #F04D43;
    transition: all 0.2s ease;
  }
</style>
{% endblock %}